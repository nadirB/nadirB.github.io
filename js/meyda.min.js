!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Meyda=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports=function(){"use strict";"use strict";!function(exports,undefined){var DefaultArrayType=Float32Array,sqrt=Math.sqrt,sqr=function(number){return Math.pow(number,2)},isComplexArray,ComplexArray;exports.isComplexArray=isComplexArray=function(obj){return obj!==undefined&&obj.hasOwnProperty!==undefined&&obj.hasOwnProperty("real")&&obj.hasOwnProperty("imag")};exports.ComplexArray=ComplexArray=function(other,opt_array_type){if(isComplexArray(other)){this.ArrayType=other.ArrayType;this.real=new this.ArrayType(other.real);this.imag=new this.ArrayType(other.imag)}else{this.ArrayType=opt_array_type||DefaultArrayType;this.real=new this.ArrayType(other);this.imag=new this.ArrayType(this.real.length)}this.length=this.real.length};ComplexArray.prototype.toString=function(){var components=[];this.forEach(function(c_value,i){components.push("("+c_value.real.toFixed(2)+","+c_value.imag.toFixed(2)+")")});return"["+components.join(",")+"]"};ComplexArray.prototype.map=function(mapper){var i,n=this.length,c_value={};for(i=0;i<n;i++){c_value.real=this.real[i];c_value.imag=this.imag[i];mapper(c_value,i,n);this.real[i]=c_value.real;this.imag[i]=c_value.imag}return this};ComplexArray.prototype.forEach=function(iterator){var i,n=this.length,c_value={};for(i=0;i<n;i++){c_value.real=this.real[i];c_value.imag=this.imag[i];iterator(c_value,i,n)}};ComplexArray.prototype.conjugate=function(){return new ComplexArray(this).map(function(value){value.imag*=-1})};function iterable(obj){if(!obj.forEach)obj.forEach=function(iterator){var i,n=this.length;for(i=0;i<n;i++)iterator(this[i],i,n)};return obj}ComplexArray.prototype.magnitude=function(){var mags=new this.ArrayType(this.length);this.forEach(function(value,i){mags[i]=sqrt(sqr(value.real)+sqr(value.imag))});return iterable(mags)}}(typeof exports==="undefined"&&(this.complex_array={})||exports);return{}}.call(Reflect.global)},{}],2:[function(require,module,exports){module.exports=function(){"use strict";"use strict";!function(exports,complex_array){var ComplexArray=complex_array.ComplexArray,PI=Math.PI,SQRT1_2=Math.SQRT1_2,sqrt=Math.sqrt,cos=Math.cos,sin=Math.sin;ComplexArray.prototype.FFT=function(){return FFT(this,false)};exports.FFT=function(input){return ensureComplexArray(input).FFT()};ComplexArray.prototype.InvFFT=function(){return FFT(this,true)};exports.InvFFT=function(input){return ensureComplexArray(input).InvFFT()};ComplexArray.prototype.frequencyMap=function(filterer){return this.FFT().map(filterer).InvFFT()};exports.frequencyMap=function(input,filterer){return ensureComplexArray(input).frequencyMap(filterer)};function ensureComplexArray(input){return complex_array.isComplexArray(input)&&input||new ComplexArray(input)}function FFT(input,inverse){var n=input.length;if(n&n-1){return FFT_Recursive(input,inverse)}else{return FFT_2_Iterative(input,inverse)}}function FFT_Recursive(input,inverse){var n=input.length,i,j,output,f_r,f_i,del_f_r,del_f_i,p,m,normalisation,recursive_result,_swap,_real,_imag;if(n===1){return input}output=new ComplexArray(n,input.ArrayType);p=LowestOddFactor(n);m=n/p;normalisation=1/sqrt(p);recursive_result=new ComplexArray(m,input.ArrayType);for(j=0;j<p;j++){for(i=0;i<m;i++){recursive_result.real[i]=input.real[i*p+j];recursive_result.imag[i]=input.imag[i*p+j]}if(m>1){recursive_result=FFT(recursive_result,inverse)}del_f_r=cos(2*PI*j/n);del_f_i=(inverse?-1:1)*sin(2*PI*j/n);f_r=1;f_i=0;for(i=0;i<n;i++){_real=recursive_result.real[i%m];_imag=recursive_result.imag[i%m];output.real[i]+=f_r*_real-f_i*_imag;output.imag[i]+=f_r*_imag+f_i*_real;_swap=f_r*del_f_r-f_i*del_f_i;f_i=f_r*del_f_i+f_i*del_f_r;f_r=_swap}}for(i=0;i<n;i++){input.real[i]=normalisation*output.real[i];input.imag[i]=normalisation*output.imag[i]}return input}function FFT_2_Iterative(input,inverse){var n=input.length,i,j,output,output_r,output_i,f_r,f_i,del_f_r,del_f_i,temp,l_index,r_index,left_r,left_i,right_r,right_i,width;output=BitReverseComplexArray(input);output_r=output.real;output_i=output.imag;width=1;while(width<n){del_f_r=cos(PI/width);del_f_i=(inverse?-1:1)*sin(PI/width);for(i=0;i<n/(2*width);i++){f_r=1;f_i=0;for(j=0;j<width;j++){l_index=2*i*width+j;r_index=l_index+width;left_r=output_r[l_index];left_i=output_i[l_index];right_r=f_r*output_r[r_index]-f_i*output_i[r_index];right_i=f_i*output_r[r_index]+f_r*output_i[r_index];output_r[l_index]=SQRT1_2*(left_r+right_r);output_i[l_index]=SQRT1_2*(left_i+right_i);output_r[r_index]=SQRT1_2*(left_r-right_r);output_i[r_index]=SQRT1_2*(left_i-right_i);temp=f_r*del_f_r-f_i*del_f_i;f_i=f_r*del_f_i+f_i*del_f_r;f_r=temp}}width<<=1}return output}function BitReverseIndex(index,n){var bitreversed_index=0;while(n>1){bitreversed_index<<=1;bitreversed_index+=index&1;index>>=1;n>>=1}return bitreversed_index}function BitReverseComplexArray(array){var n=array.length,flips={},swap,i;for(i=0;i<n;i++){var r_i=BitReverseIndex(i,n);if(flips.hasOwnProperty(i)||flips.hasOwnProperty(r_i))continue;swap=array.real[r_i];array.real[r_i]=array.real[i];array.real[i]=swap;swap=array.imag[r_i];array.imag[r_i]=array.imag[i];array.imag[i]=swap;flips[i]=flips[r_i]=true}return array}function LowestOddFactor(n){var factor=3,sqrt_n=sqrt(n);while(factor<=sqrt_n){if(n%factor===0)return factor;factor=factor+2}return n}}(typeof exports==="undefined"&&(this.fft={})||exports,typeof require==="undefined"&&this.complex_array||require("./complex_array"));return{}}.call(Reflect.global)},{"./complex_array":1}],3:[function(require,module,exports){"use strict";module.exports={loudness:require("./loudness")}},{"./loudness":4}],4:[function(require,module,exports){"use strict";function Loudness(opts){if(!(this instanceof Loudness))return new Loudness(opts);this.info={type:"multipleArrays",arrayNames:{1:"total",2:"specific"}};this.NUM_BARK_BANDS=opts.NUM_BARK_BANDS||24;this.normalisedSpectrum=opts.normalisedSpectrum;this.sampleRate=opts.sampleRate;this.specific=new Float32Array(this.NUM_BARK_BANDS);this.process=this.process.bind(this);this.barkScale=opts.barkScale;this.bbLimits=this.computeBarkBandLimits(this.barkScale,this.normalisedSpectrum.length,this.NUM_BARK_BANDS)}Loudness.prototype.computeBarkBandLimits=function(barkScale,nSpectrumLength,num_bark_bands){barkScale=barkScale||this.barkScale;nSpectrumLength=nSpectrumLength||this.normalisedSpectrum.length;num_bark_bands=num_bark_bands||this.NUM_BARK_BANDS;var currentBandEnd=barkScale[nSpectrumLength-1]/num_bark_bands;var currentBand=1;var bbLimits=new Int32Array(num_bark_bands+1);bbLimits[0]=0;for(var i=0;i<nSpectrumLength;i++){while(barkScale[i]>currentBandEnd){bbLimits[currentBand++]=i;currentBandEnd=currentBand*barkScale[nSpectrumLength-1]/num_bark_bands}}bbLimits[num_bark_bands]=nSpectrumLength-1;return bbLimits};Loudness.prototype.computeSpecificLoudness=function(bbLimits,specific,nSpectrum,num_bark_bands){bbLimits=bbLimits||this.bbLimits;specific=specific||this.specific;nSpectrum=nSpectrum||this.normalisedSpectrum;num_bark_bands=num_bark_bands||this.NUM_BARK_BANDS;for(var i=0;i<num_bark_bands;i++){var sum=0;for(var j=bbLimits[i];j<bbLimits[i+1];j++){sum+=nSpectrum[j]}specific[i]=Math.pow(sum,.23)}return specific};Loudness.prototype.sumArray=function(array){var sum=0;for(var i=0;i<array.length;i++){sum+=array[i]}return sum};Loudness.prototype.process=function(){var barkScale=this.barkScale;var nSpectrum=this.normalisedSpectrum;var nSpectrumLength=nSpectrum.length;var NUM_BARK_BANDS=this.NUM_BARK_BANDS;var specific=this.specific;var bbLimits=this.bbLimits;var spec=this.computeSpecificLoudness(bbLimits,specific,nSpectrum,NUM_BARK_BANDS);var total=this.sumArray(spec);return{specific:spec,total:total}};module.exports=Loudness},{}],5:[function(require,module,exports){"use strict";module.exportts={buffer:{type:"array"},rms:{type:"number"},energy:{type:"number"},zcr:{type:"number"},complexSpectrum:{type:"multipleArrays",arrayNames:{1:"real",2:"imag"}},amplitudeSpectrum:{type:"array"},powerSpectrum:{type:"array"},spectralCentroid:{type:"number"},spectralFlatness:{type:"number"},spectralSlope:{type:"number"},spectralRolloff:{type:"number"},spectralSpread:{type:"number"},spectralSkewness:{type:"number"},spectralKurtosis:{type:"number"},loudness:{type:"multipleArrays",arrayNames:{1:"total",2:"specific"}},perceptualSpread:{type:"number"},perceptualSharpness:{type:"number"},mfcc:{type:"array"}}},{}],6:[function(require,module,exports){"use strict";var ComplexArray=require("../lib/jsfft/complex_array").ComplexArray,fft=require("../lib/jsfft/fft");var $__3=require("./utils"),isPowerOfTwo=$__3.isPowerOfTwo,µ=$__3.µ;var Meyda=function Meyda(audioContext,src,bufSize,callback){var $__0=this;if(!isPowerOfTwo(bufSize)){throw new Error("Buffer size is not a power of two: Meyda will not run.")}if(!audioContext){throw new Error("AudioContext wasn't specified: Meyda will not run.")}var bufferSize=bufSize||256;var sampleRate=audioContext.sampleRate;var source=src;this.audioContext=audioContext;this.featureExtractors={};this.EXTRACTION_STARTED=false;this._featuresToExtract=null;this.windowingFunction="hanning";this.barkScale=this.computeBarkScale(bufferSize,sampleRate);this.hanning=this.computeHanning(bufferSize);this.hamming=this.computeHamming(bufferSize);this.featureInfo=require("./feature-info");var computedSpectrumData=this.computeSpectrumData(bufferSize);this.spectrumData=computedSpectrumData.data;this.complexSpectrum=computedSpectrumData.spectrum;this.ampSpectrum=computedSpectrumData.ampSpectrum;this.initialiseExtractors();window.spn=audioContext.createScriptProcessor(bufferSize,1,1);window.spn.onaudioprocess=function(e){var signal=$__0.signal=e.inputBuffer.getChannelData(0);var data=$__0.spectrumData;var spec=$__0.complexSpectrum;var ampSpectrum=$__0.ampSpectrum;var windowedSignal=$__0.computeWindow(signal,$__0.windowingFunction);data.map(function(value,i,n){value.real=windowedSignal[i]});$__0.computeAmplitude(spec,ampSpectrum,bufferSize);if(typeof callback==="function"&&EXTRACTION_STARTED){callback($__0.get($__0._featuresToExtract))}};window.spn.connect(audioContext.destination);source.connect(window.spn,0,0)};$traceurRuntime.createClass(Meyda,{computeAmplitude:function(complexSpectrum,ampSpectrum,bufferSize){complexSpectrum=complexSpectrum||this.complexSpectrum;ampSpectrum=ampSpectrum||this.ampSpectrum;bufferSize=bufferSize||this.bufferSize;for(var i=0;i<bufferSize/2;i++){ampSpectrum[i]=Math.sqrt(Math.pow(complexSpectrum.real[i],2)+Math.pow(complexSpectrum.imag[i],2))}},computeHamming:function(bufferSize){bufferSize=bufferSize||this.bufferSize;var hamming=new Float32Array(bufferSize);for(var i=0;i<bufferSize;i++){hamming[i]=.54-.46*Math.cos(2*Math.PI*(i/bufferSize-1))}return hamming},computeHanning:function(bufferSize){bufferSize=bufferSize||this.bufferSize;var hanning=new Float32Array(bufferSize);for(var i=0;i<bufferSize;i++){hanning[i]=.5-.5*Math.cos(2*Math.PI*i/(bufferSize-1))}return hanning},computeWindow:function(sig,type){var i,len=sig.length;var windowed=new Float32Array(len);for(i=0;i<len;i++){windowed[i]=sig[i]*this[type][i]}return windowed},computeBarkScale:function(bufferSize,sampleRate){bufferSize=bufferSize||this.bufferSize;sampleRate=sampleRate||this.sampleRate;var barkScale=new Float32Array(bufferSize);for(var i=0;i<bufferSize;i++){barkScale[i]=i*sampleRate/bufferSize;barkScale[i]=13*Math.atan(barkScale[i]/1315.8)+3.5*Math.atan(Math.pow(barkScale[i]/7518,2))}return barkScale},computeSpectrumData:function(bufferSize){bufferSize=bufferSize||this.bufferSize;var data=new ComplexArray(bufferSize);var spectrum=data.FFT();var ampSpectrum=new Float32Array(bufferSize/2);return{data:data,spectrum:spectrum,ampSpectrum:ampSpectrum}},initialiseExtractors:function(){var extractors=require("./extractors");var loudness=extractors.loudness({NUM_BARK_BANDS:24,barkScale:this.barkScale,normalisedSpectrum:this.ampSpectrum,sampleRate:this.audioContext.sampleRate});this.featureExtractors.loudness=loudness;this.featureInfo.loudness=loudness.info},setSource:function(_src){_src.connect(window.spn)},start:function(features){this._featuresToExtract=features;this.EXTRACTION_STARTED=true},stop:function(){this._featuresToExtract=null;this.EXTRACTION_STARTED=false},get:function(feature){if(typeof feature==="object"){var results={};for(var x=0;x<feature.length;x++){try{results[feature[x]]=this.featureExtractors[feature[x]].process(this.signal)}catch(e){console.error(e)}}return results}else if(typeof feature==="string"){return this.featureExtractors[feature].process(this.signal)}else{throw new Error("Invalid Feature Format")}}},{});module.exports=Meyda},{"../lib/jsfft/complex_array":1,"../lib/jsfft/fft":2,"./extractors":3,"./feature-info":5,"./utils":7}],7:[function(require,module,exports){"use strict";module.exports.µ=function(i,amplitudeSpect){var numerator=0;var denominator=0;for(var k=0;k<amplitudeSpect.length;k++){numerator+=Math.pow(k,i)*Math.abs(amplitudeSpect[k]);denominator+=amplitudeSpect[k]}return numerator/denominator};module.exports.isPowerOfTwo=function(num){while(num%2===0&&num>1){num/=2}return num==1}},{}]},{},[6])(6)});